---
title: "Factor Variables"
output: html_document
---

## R Learning Module
## Factor variables

# Creating factor variables
# 인자 변수 만들기
인자 변수는 숫자 또는 문자열 변수가 될 수 있는 범주형 변수이다
범주형 변수를 인자 변수로 전환하는데에 많은 장점들이 있다.
가장 중요한 이점은 정확하게 수행되어져야 할 통계적 모델링에 사용된다는 것이다.
인자 변수는 많은 다양한 그래픽 형태에서 매우 유용하다.
게다가, 인자 변수로 문자열 변수를 저장하는 것은 메모리 사용에 효율적이다.
인자 변수를 만들기 위해, ** factor ** 함수를 사용한다.
필수 인자는 숫자 또는 문자열로 이루어진 벡터값이다.
선택 인자는 인자 변수의 범주를 결정하는 ** levels ** 인자를 포함한다. 그리고 기본값은 벡터 데이터의 모든 별개의 값들을 정렬한 리스트이다.
또 다른 선택 옵션은 ** labels **가 있다. 이는 ** levels ** 인자 안에 범주들의 라벨을이 되는 값들의 벡터이다.
** exclude ** 인자 또한 선택 인자인데, 이는 어떤 levels가 인자 변수를 사용하는 어느 결과물 안에서나 NA로 분류화 되어질 수 있는지 결정한d다.

먼저 **schtyp** 라 불리는 숫자형 데이터 벡터를 생성한다.
이는 무작위의 숫자 생성기를 포함하여 복사(재생)할 수 있는 결과를 만들기 위해 124와 같은 씨앗(seed)를 셋팅한다.

```{r}
set.seed(124)
schtyp <- sample(0:1, 20, replace = TRUE)
schtyp
```

```{r}
is.factor(schtyp)
```

```{r}
is.numeric(schtyp)
```

이제 schtyp를 기반으로하여 schtyp.f라 불리는 인자 변수를 만들어보자.
첫번째 라벳은 private이며 schtyp=0과 일치할 것이고, 두번째 라벨은 public이며 schtyp=1과 일치할 것이다. 왜냐하면 라벨의 순서는 데이터의 숫자 순서를 따르기 때문이다.

```{r}
schtyp.f <- factor(schtyp, labels = c("private", "public"))
schtyp.f
```

```{r}
is.factor(schtyp.f)
```

다음으로 ses(socio-economic status)라 불리는 문자열 변수를 만든다.

```{r}
ses <- c("low", "middle", "low", "low", "low", "low", "middle", "low", "middle", "middle", "middle", "middle", "middle", "high", "high", "low", "middle", "middle", "low", "high")

is.factor(ses)

```

ses 변수를 기반으로 ses.f.bad.order라는 인자 변수를 만든다.

```{r}
ses.f.bad.order <- factor(ses)
is.factor(ses.f.bad.order)
```

```{r}
levels(ses.f.bad.order)
```

문제는 **levels**가 **ses** 변수의 범주의 알파벳 순서에 따라 정렬되어진다는 것이다. 그래서 "high" 가 **ses.f.bad.order**의 최저 수준이고 "middle"은 중간 수준, "low"가 최고 수준이 된다. 순서를 수정하기 위해 'levels' 인자를 범주의 정확한 순서를 명시해줘야 한다. 범주의 정확한 순서를 가진 **ses.f** 이름의 인자 변수를 만들어보자.

```{r}
ses.f <- factor(ses, levels = c("low", "middle", "high"))
is.factor(ses.f)
```

```{r}
levels(ses.f)
```

## 2. Creating Ordered factor variables
'ordered' 기능을 사용하여 정렬된 인자 변수를 만들 수 있다.
이 기능은 'factor' 기능과 같은 인자를 가진다.
위의 예에서 만든 **ses** 변수를 기반으로 **Ses.order** 이름으로 정렬된 인자 변수를 만들어보자.

```{r}
ses.order <- ordered(ses, levels = c("low", "middle", "high"))
ses
```

```{r}
ses.order
```

```{r}
is.factor(ses.order)
```

## 3. Adding and dropping levels in factor variables
## 3. 인자 변수의 수준 추가 및 삭제
아래에서 우리는 "very.high" 라는 새로운 수준의 요소를 우리가 만든 **ses.f** 변수에 추가할 것이다.
사각 괄호안의 숫자 ([21])은 우리가 바꾸길 원하는 라벨을 가진 요소의 숫자를 가리킨다.

```{r}
ses.f[21] <- "very.high"
```

```{r}
ses.f
```

"high"를 "very.high"로 바뀌는 것 대신에 그 라벨이 "high"에서 <NA>로 바뀌어진 것을 확인할 수 있다.
이를 정확하게 하려면, 먼저 "very.high"라는 새로운 수준을 **levels** 인자를 가진 **facotr** 기능을 사용하는 우리가 만든 **ses.f** 인자 변수에 넣어야 한다.
그러면 우리는 최종적으로 새로운 수준으로부터 요소를 인자 변수에 추가할 수 있다.

```{r}
ses.f <- factor(ses.f, levels = c(levels(ses.f), "very.high"))
ses.f[21] <- "very.high"
ses.f
```
```{r}
levels(ses.f)
```

인자변수의 수준 삭제는 조금 더 쉽다. 가장 간단한 방법은 먼저 삭제할 수준 안의 모든 요소들을 삭제하고, 인자 변수에 변수를 재선언하는 것이다.
만약 그 수준에 요소가 없다면 그 수준은 자동적으로 삭제 되지 않는다. 왜냐하면, 우리는 특정한 수준으로부터의 요소들을 포함하고 있지 않은 샘플을 가질 수 있었다(?).
**ses.f** 변수에 "very.high" 수준을 삭제해보자

```{r}
ses.f.new <- ses.f[ses.f != "very.high"]
ses.f.new
```
```{r}
ses.f.new <-factor(ses.f.new)
ses.f.new
```
```{r}
levels(ses.f.new)
```

## 4. Examples of the usefulness of factor variables
## 4. 인자 변수의 유용성의 예제

인자변수의 유용성을 보여주기 위해, 먼저 우리가 이전 예제에서 사용했던 모든 변수들을 가지는 데이터 프레임을 만들 것이다.
그리 추가적인 **read** 로 명명한 읽기 점수를 포함하는 연속 변수를 더할 것이다.
또, **ses.f**가 "Very.high" 요소가 없는 **ses.f.new** 변수와 같게끔 재정의할 것이다.
```{r}
ses.f <- ses.f.new
read <- c(34, 39, 63, 44, 47, 47, 57, 39, 48, 47, 34, 37, 47, 47, 39, 47, 47, 50, 28, 60)

# combining all the variables in a data frame
combo <- data.frame(schtyp, schtyp.f, ses, ses.f, read)
```
인자 변수를 사용할 때 테이블들 해석하기 더 쉽다.
왜냐하면 인자변수는 유용한 라벨들을 테이블에 추가하고 더 이해하기 쉬운 순서로 인자들을 배열하기 때문이다.

```{r}
table(ses, schtyp)
```
```{r}
table(ses.f, schtyp.f)
```
그래픽은 인자 변수의 사용으로부터 혜택을 받는 다른 영역이다.
테이블안에 따라 인자 변수는 유용한 라벨이 잘 추가 됨에 따라 더 나은 순서의 그래프를 가리킨다.
```{r}
library(lattice)
bwplot(schtyp ~ read | ses, data = combo, layout = c(2,2))
```
```{r}
bwplot(schtyp.f ~ read | ses.f, data = combo, layout = c(2,2))
```

